<!-- order.wxml - ä¿®å¤æ›´å¤šæŒ‰é’®ç‚¹å‡»äº‹ä»¶å’Œå¸ƒå±€ -->
<view class="order-container" bindtap="onPageTap">
  
  <!-- è®¢å•ç±»å‹åˆ‡æ¢ -->
  <view class="order-type">
    <view 
      wx:for="{{orderTypeList}}" 
      wx:key="id" 
      class="{{activeOrderType == item.id ? 'active-type' : ''}}" 
      bindtap="switchOrderType" 
      data-type="{{item.id}}">
      {{item.name}}
    </view>
  </view>
  
  <!-- è®¢å•çŠ¶æ€åˆ‡æ¢ -->
  <view class="order-status-bar">
    <view 
      wx:for="{{statusList}}" 
      wx:key="id" 
      class="status-item {{activeStatus == item.id ? 'active-status' : ''}}" 
      bindtap="switchStatus" 
      data-status="{{item.id}}">
      <text>{{item.name}}</text>
      <!-- æ´»è·ƒçŠ¶æ€ä¸‹åˆ’çº¿ç§»åˆ°çŠ¶æ€æ–‡å­—ä¸‹æ–¹ -->
      <view class="active-line" wx:if="{{activeStatus == item.id}}"></view>
    </view>
  </view>
  
  <!-- è®¢å•åˆ—è¡¨ -->
  <view class="order-list">
    <block wx:if="{{orderList.length > 0}}">
      
      <!-- è®¢å•é¡¹ - æ·»åŠ åŠ¨æ€CSSç±»æ§åˆ¶å±‚çº§ -->
      <view wx:for="{{orderList}}" wx:key="id" class="order-item {{item.statusClassName}} {{item.cssClasses}}" data-status="{{item.orderStatus}}">
        
        <!-- è®¢å•å¤´éƒ¨ï¼šçŠ¶æ€å’Œä»·æ ¼ -->
        <view class="order-header">
          <view class="success-status">{{item.statusText}}</view>
          <!-- æœ‰ç»­ç§Ÿæˆ–è¡¥ç¼´æ—¶ä¸æ˜¾ç¤ºä»·æ ¼ -->
          <view class="order-price" wx:if="{{item.shouldShowPrice}}">
            <text>{{item.priceDisplayText}}</text>
          </view>
        </view>
        
        <!-- è½¦è¾†ä¿¡æ¯ -->
        <view class="car-info">
          <view class="car-name">{{item.carModel}}</view>
          <image class="car-image" src="{{item.carImage}}" mode="aspectFit"></image>
        </view>
        
        <!-- é—¨åº—ä¿¡æ¯ -->
        <view class="store-info">
          <view class="store-point orange"></view>
          <view class="store-name">{{item.pickupStore}}</view>
        </view>
        <view class="store-info">
          <view class="store-point green"></view>
          <view class="store-name">{{item.returnStore}}</view>
        </view>
        
        <!-- ç§Ÿèµæ—¶é—´ï¼ˆæŒ‰å‡ºè½¦è®°å½•æ˜¾ç¤ºï¼‰ -->
        <view class="rental-time">
          <view class="time-info">{{item.pickupTime}}</view>
          <view class="time-info">â€”</view>
          <view class="day-count">{{item.rentalDays}}å¤©</view>
          <view class="time-info">â€”</view>
          <view class="time-info">{{item.returnTime}}</view>
        </view>
        
        <!-- è®¢å•é“¾æŠ˜å åŒºåŸŸ -->
        <view class="order-chain-section" wx:if="{{item.hasOrderChain}}">
          <!-- æŠ˜å å¤´éƒ¨ -->
          <view class="chain-header" catchtap="toggleOrderChain" data-order-id="{{item.id}}">
            <view class="chain-info">
              <text class="chain-icon">ğŸ”—</text>
              <text class="chain-title">è®¢å•é“¾è¯¦æƒ… ({{item.chainSummary.totalOrders}}ä¸ªè®¢å•)</text>
              <!-- ä½¿ç”¨é¢„è®¡ç®—çš„æ ‡ç­¾ -->
              <view wx:for="{{item.chainSummary.badges}}" wx:key="type" class="{{item.type}}-badge">
                {{item.text}}
              </view>
            </view>
            <view class="chain-arrow {{item.isChainExpanded ? 'expanded' : ''}}">
              â–¼
            </view>
          </view>
          
          <!-- æŠ˜å å†…å®¹ -->
          <view class="chain-content" wx:if="{{item.isChainExpanded}}">
            
            <!-- è®¢å•é“¾æ¡åˆ—è¡¨ -->
            <view wx:for="{{item.processedChainDetails}}" wx:key="orderId" wx:for-item="chainItem" class="chain-item">
              
              <!-- è®¢å•ç±»å‹å’ŒçŠ¶æ€ -->
              <view class="chain-item-header">
                <view class="order-type-tag {{chainItem.typeClassName}}">
                  {{chainItem.orderType}}
                </view>
                <view class="order-status-tag {{chainItem.statusClassName}}">
                  {{chainItem.orderStatus}}
                </view>
              </view>
              
              <!-- è®¢å•è¯¦ç»†ä¿¡æ¯ -->
              <view class="chain-item-body">
                <view class="detail-row">
                  <text class="detail-label">è®¢å•ç¼–å·:</text>
                  <text class="detail-value">{{chainItem.orderId}}</text>
                </view>
                <view class="detail-row">
                  <text class="detail-label">è®¢å•ä»·æ ¼:</text>
                  <text class="detail-value price-value">{{chainItem.formattedPrice}}</text>
                </view>
                <view class="detail-row">
                  <text class="detail-label">ç”Ÿæ•ˆæ—¶é—´:</text>
                  <text class="detail-value">{{chainItem.formattedEffectiveTime}}</text>
                </view>
                <view class="detail-row">
                  <text class="detail-label">ç§ŸæœŸå¤©æ•°:</text>
                  <text class="detail-value">{{chainItem.rentalDays}}å¤©</text>
                </view>
                <view class="detail-row">
                  <text class="detail-label">åˆ›å»ºæ—¶é—´:</text>
                  <text class="detail-value">{{chainItem.formattedCreateTime}}</text>
                </view>
                
                <!-- è¶…æ—¶ä¿¡æ¯ -->
                <block wx:if="{{chainItem.showOvertimeInfo}}">
                  <view class="detail-row overtime-row">
                    <text class="detail-label">è¶…æ—¶æƒ…å†µ:</text>
                    <text class="detail-value overtime-text">è¶…æ—¶{{chainItem.overtimeHours}}å°æ—¶</text>
                  </view>
                  <view class="detail-row" wx:if="{{chainItem.actualEndTime}}">
                    <text class="detail-label">å®é™…è¿˜è½¦:</text>
                    <text class="detail-value">{{chainItem.actualEndTime}}</text>
                  </view>
                  <view class="detail-row" wx:if="{{chainItem.formattedOvertimeFee}}">
                    <text class="detail-label">è¶…æ—¶è´¹ç”¨:</text>
                    <text class="detail-value overtime-fee">{{chainItem.formattedOvertimeFee}}</text>
                  </view>
                  <!-- è¡¥ç¼´è®¢å•æ ‡è¯† -->
                  <view class="payment-notice" wx:if="{{chainItem.showPaymentNotice}}">
                    <text class="notice-icon">ğŸ’°</text>
                    <text class="notice-text">æ­¤è®¢å•éœ€è¦è¡¥ç¼´è¶…æ—¶è´¹ç”¨</text>
                  </view>
                </block>
              </view>
            </view>
            
            <!-- å‡ºè½¦è®°å½•ä¿¡æ¯ -->
            <view class="vehicle-record">
              <view class="record-header">
                <text class="record-icon">ğŸš—</text>
                <text class="record-title">å‡ºè½¦è®°å½•ä¿¡æ¯</text>
              </view>
              <view class="record-content">
                <view class="record-row">
                  <text class="record-label">è®°å½•ç¼–å·:</text>
                  <text class="record-value">{{item.vehicleRecordId}}</text>
                </view>
                <view class="record-row">
                  <text class="record-label">è½¦è¾†ç¼–å·:</text>
                  <text class="record-value">{{item.carNumber}}</text>
                </view>
                <view class="record-row">
                  <text class="record-label">æ€»ç§ŸæœŸ:</text>
                  <text class="record-value">{{item.totalRentalDays}}å¤©</text>
                </view>
                <view class="record-row">
                  <text class="record-label">ç»­ç§Ÿæ¬¡æ•°:</text>
                  <text class="record-value">{{item.renewalCount}}æ¬¡</text>
                </view>
                <view class="record-row">
                  <text class="record-label">å–è½¦æ—¶é—´:</text>
                  <text class="record-value">{{item.pickupTime}}</text>
                </view>
                <view class="record-row">
                  <text class="record-label">è¿˜è½¦æ—¶é—´:</text>
                  <text class="record-value">{{item.returnTime}}</text>
                </view>
                <view class="record-row" wx:if="{{item.hasPayment}}">
                  <text class="record-label">è¡¥ç¼´çŠ¶æ€:</text>
                  <text class="record-value payment-status">å­˜åœ¨è¶…æ—¶è¡¥ç¼´è´¹ç”¨</text>
                </view>
              </view>
            </view>
          </view>
        </view>
        
        <!-- æ“ä½œæŒ‰é’®åŒºåŸŸ -->
        <view class="order-actions">
          
          <!-- æ›´å¤šæ“ä½œä¸‹æ‹‰èœå• - ä¿®å¤äº‹ä»¶ç»‘å®š -->
          <view class="more-action" catchtap="showMoreActions" data-id="{{item.id}}">
            æ›´å¤š
            <!-- ä¸‹æ‹‰èœå•å†…å®¹ - ä¿®å¤æ˜¾ç¤ºé€»è¾‘ -->
            <view class="more-dropdown {{item.isMoreMenuOpen ? 'show' : ''}}" catchtap="stopPropagation">
              <view wx:for="{{item.moreMenuItems}}" wx:key="action" wx:for-item="menuItem" class="dropdown-item" catchtap="handleAction" data-action="{{menuItem.action}}" data-id="{{item.id}}">
                {{menuItem.text}}
              </view>
            </view>
          </view>
          
          <!-- ä½¿ç”¨é¢„è®¡ç®—çš„æ“ä½œæŒ‰é’®é…ç½® -->
          <view wx:for="{{item.actionButtons}}" wx:key="action" wx:for-item="button" class="action-button {{button.highlight ? 'highlight' : ''}}" bindtap="handleAction" data-action="{{button.action}}" data-id="{{item.id}}">
            {{button.text}}
          </view>
          
        </view>
      </view>
      
    </block>
    
    <!-- æ— è®¢å•çŠ¶æ€ -->
    <view class="no-order" wx:else>
      <image src="/images/no-order.png" mode="aspectFit"></image>
      <text>æš‚æ— è®¢å•</text>
    </view>
    
    <!-- åŠ è½½æ›´å¤š -->
    <view class="load-more" wx:if="{{orderList.length > 0}}">
      <text wx:if="{{isLoading}}">åŠ è½½ä¸­...</text>
      <text wx:elif="{{hasMoreOrders}}" bindtap="loadMoreOrders">åŠ è½½æ›´å¤š</text>
      <text wx:else>æ²¡æœ‰æ›´å¤šæ•°æ®äº†</text>
    </view>
  </view>
  
  <!-- æœç´¢æŒ‰é’® -->
  <view class="search-btn" bindtap="searchOrder">
    <image src="/images/search.png"></image>
    <text>æœç´¢</text>
  </view>
  
</view>