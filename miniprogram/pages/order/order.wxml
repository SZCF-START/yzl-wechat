<view class="order-container">
  <!-- 订单类型切换 -->
  <view class="order-type">
    <view 
      wx:for="{{orderTypeList}}" 
      wx:key="id" 
      class="{{activeOrderType == item.id ? 'active-type' : ''}}" 
      bindtap="switchOrderType" 
      data-type="{{item.id}}">
      {{item.name}}
    </view>
  </view>
  
  <!-- 订单状态切换 -->
  <view class="order-status-bar">
    <view 
      wx:for="{{statusList}}" 
      wx:key="id" 
      class="status-item {{activeStatus == item.id ? 'active-status' : ''}}" 
      bindtap="switchStatus" 
      data-status="{{item.id}}">
      <text>{{item.name}}</text>
      <view class="active-line" wx:if="{{activeStatus == item.id}}"></view>
    </view>
  </view>
  
  <!-- 订单列表 -->
  <view class="order-list">
    <block wx:if="{{orderList.length > 0}}">
      <view class="order-item" wx:for="{{orderList}}" wx:key="id">
        <view class="order-header">
          <view class="success-status">{{item.statusText}}</view>
          <view class="order-price">¥{{item.price}}</view>
        </view>
        <view class="car-info">
          <view class="car-name">{{item.carModel}}</view>
          <image class="car-image" src="{{item.carImage}}" mode="aspectFit"></image>
        </view>
        <view class="store-info">
          <view class="store-point orange"></view>
          <view class="store-name">{{item.pickupStore}}</view>
        </view>
        <view class="store-info">
          <view class="store-point green"></view>
          <view class="store-name">{{item.returnStore}}</view>
        </view>
        <view class="rental-time">
          <view class="time-info">{{item.pickupTime}}</view>
          <view class="time-info">—</view>
          <view class="day-count">{{item.rentalDays}}天</view>
          <view class="time-info">—</view>
          <view class="time-info">{{item.returnTime}}</view>
        </view>
        <view class="order-actions">
          <!-- 更多下拉菜单 - 只在有菜单项时显示 -->
          <view class="more-action" 
                wx:if="{{item.orderStatus == 0 || item.orderStatus == 1 || item.orderStatus == 2 || item.orderStatus == 3}}"
                bindtap="showMoreActions" 
                catchtap="showMoreActions"
                data-id="{{item.id}}">更多
            <!-- 更多下拉菜单 -->
            <view class="more-dropdown {{item.id === activeMoreId ? 'show' : ''}} {{item.isLeftAligned ? 'left-aligned' : ''}}" catchtap="stopPropagation">
              <!-- 车辆详情 - 所有状态都有 -->
              <view class="dropdown-item" bindtap="viewCarDetails" data-id="{{item.id}}">车辆详情</view>
              
              <!-- 修改订单 - 预约中和租赁中状态有 -->
              <view class="dropdown-item" 
                    wx:if="{{item.orderStatus == 0 || item.orderStatus == 1}}" 
                    bindtap="modifyOrder" 
                    data-id="{{item.id}}">修改订单</view>
              
              <!-- 取消订单 - 只有预约中状态有 -->
              <view class="dropdown-item" 
                    wx:if="{{item.orderStatus == 0}}" 
                    bindtap="cancelOrder" 
                    data-id="{{item.id}}">取消订单</view>
            </view>
          </view>
          
          <!-- 预约中状态的按钮：咨询、取车门店指引、取车 -->
          <block wx:if="{{item.orderStatus == 0}}">
            <view class="action-button highlight" bindtap="handleConsult" data-id="{{item.id}}">咨询</view>
            <view class="action-button highlight" bindtap="handlePickupGuide" data-id="{{item.id}}">取车门店指引</view>
            <view class="action-button highlight" bindtap="handlePickup" data-id="{{item.id}}">取车</view>
          </block>
          
          <!-- 租赁中状态的按钮：取车门店指引、续租、还车 -->
          <block wx:elif="{{item.orderStatus == 1}}">
            <view class="action-button highlight" bindtap="handlePickupGuide" data-id="{{item.id}}">取车门店指引</view>
            <view class="action-button highlight" bindtap="handleRenewal" data-id="{{item.id}}">续租</view>
            <view class="action-button highlight" bindtap="handleReturn" data-id="{{item.id}}">还车</view>
          </block>
          
          <!-- 已完成和已取消状态：没有操作按钮 -->
        </view>
      </view>
    </block>
    <view class="no-order" wx:else>
      <image src="/images/no-order.png" mode="aspectFit"></image>
      <text>暂无订单</text>
    </view>
    
    <!-- 加载更多 -->
    <view class="load-more" wx:if="{{orderList.length > 0}}">
      <text wx:if="{{isLoading}}">加载中...</text>
      <text wx:elif="{{hasMoreOrders}}" bindtap="loadMoreOrders">加载更多</text>
      <text wx:else>没有更多数据了</text>
    </view>
  </view>
</view>