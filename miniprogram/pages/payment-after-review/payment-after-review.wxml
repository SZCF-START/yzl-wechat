<view class="payment-container">
  <!-- 订单信息 -->
  <view class="order-info">
    <view class="info-header">
      <text class="info-title">订单信息</text>
    </view>
    <view class="info-row">
      <text class="info-label">门店名称：</text>
      <text class="info-value">{{orderInfo.storeName}}</text>
    </view>
    <view class="info-row">
      <text class="info-label">管理员：</text>
      <text class="info-value">{{orderInfo.managerName}}</text>
      <text class="phone-link" bindtap="makePhoneCall" data-phone="{{orderInfo.managerPhone}}">{{orderInfo.managerPhone}}</text>
    </view>
    <view class="info-row">
      <text class="info-label">车型名称：</text>
      <text class="info-value">{{orderInfo.carModel}}</text>
    </view>
    <view class="info-row">
      <text class="info-label">租赁时间：</text>
      <text class="info-value">{{orderInfo.startTime}} —— {{orderInfo.endTime}}</text>
    </view>
    <view class="info-row">
      <text class="info-label">租赁天数：</text>
      <text class="info-value highlight">{{orderInfo.rentalDays}}天</text>
    </view>
  </view>

  <!-- 出车时仪表盘数据 -->
  <view class="dashboard-info">
    <view class="info-header">
      <text class="info-title">出车时仪表盘数据</text>
    </view>
    <view class="dashboard-display">
      <text class="dashboard-value">{{orderInfo.initialHours}}小时</text>
    </view>
  </view>

  <!-- 用户还车时仪表盘数据 -->
  <view class="dashboard-info">
    <view class="info-header">
      <text class="info-title">用户还车时仪表盘数据</text>
    </view>
    <view class="dashboard-display">
      <text class="dashboard-value">{{returnData.userReturnHours}}小时</text>
    </view>
  </view>

  <!-- 管理员审核后修改的数据 -->
  <view class="review-section">
    <view class="info-header">
      <text class="info-title">管理员审核后修改的数据</text>
    </view>
    <view class="review-item">
      <text class="review-label">修改后仪表盘数据：</text>
      <text class="review-value highlight">{{returnData.adminReturnHours}}小时</text>
    </view>
    <view class="review-item">
      <text class="review-label">实际还车时间：</text>
      <text class="review-value">{{returnData.actualReturnTime}}</text>
    </view>
    <view class="review-item">
      <text class="review-label">仪表盘照片：</text>
    </view>
    <view class="dashboard-image">
      <image class="review-image" src="{{returnData.dashboardImage}}" mode="aspectFill"></image>
    </view>
  </view>

  <!-- 超时计算结果 -->
  <view class="overtime-result">
    <view class="info-header">
      <text class="info-title">超时计算结果</text>
      <text class="question-icon" bindtap="showOvertimeDetail">?</text>
    </view>
    <view class="overtime-info">
      <text class="overtime-text">
        最终超时了 <text class="highlight">{{finalOvertimeDays}}天</text>
      </text>
    </view>
  </view>

  <!-- 已支付和剩余支付 -->
  <view class="payment-status">
    <view class="info-header">
      <text class="info-title">支付状态</text>
    </view>
    <view class="payment-item">
      <text class="payment-label">已支付超时天数：</text>
      <text class="payment-value">{{paidOvertimeDays}}天</text>
    </view>
    <view class="payment-item">
      <text class="payment-label">剩余需支付天数：</text>
      <text class="payment-value highlight">{{remainingOvertimeDays}}天</text>
    </view>
  </view>

  <!-- 价格选择 -->
  <view class="price-selection" wx:if="{{remainingOvertimeDays > 0}}">
    <view class="info-header">
      <text class="info-title">选择计费方式</text>
    </view>
    <view class="price-options">
      <view class="price-card {{selectedPriceType === 'overtime' ? 'selected' : ''}}" 
            bindtap="selectPriceType" data-type="overtime">
        <view class="price-type">超时单价</view>
        <view class="price-value">¥{{overtimePrice}}/天</view>
        <view class="total-price">总计：¥{{overtimeTotalPrice}}</view>
      </view>
      <view class="price-card {{selectedPriceType === 'renewal' ? 'selected' : ''}}" 
            bindtap="selectPriceType" data-type="renewal">
        <view class="price-type">续租单价</view>
        <view class="price-value">¥{{renewalPrice}}/天</view>
        <view class="total-price">总计：¥{{renewalTotalPrice}}</view>
      </view>
    </view>
  </view>

  <!-- 最终支付金额 -->
  <view class="final-payment" wx:if="{{remainingOvertimeDays > 0}}">
    <view class="payment-info">
      <text class="payment-label">需要支付：</text>
      <text class="payment-amount">¥{{finalPaymentAmount}}</text>
    </view>
  </view>

  <!-- 无需支付提示 -->
  <view class="no-payment" wx:if="{{remainingOvertimeDays <= 0}}">
    <view class="no-payment-info">
      <text class="no-payment-text">无需额外支付</text>
      <text class="no-payment-desc">已支付金额已覆盖所有超时费用</text>
    </view>
  </view>

  <!-- 支付按钮 -->
  <view class="submit-section">
    <button class="submit-btn" bindtap="submitPayment" disabled="{{!canPayment}}" wx:if="{{remainingOvertimeDays > 0}}">
      支付
    </button>
    <button class="submit-btn completed" bindtap="goToComplete" wx:else>
      订单已完成
    </button>
  </view>
</view>

<!-- 超时详情弹窗 -->
<view class="modal-mask" wx:if="{{showOvertimeModal}}" bindtap="hideOvertimeDetail">
  <view class="modal-content" catchtap="stopPropagation">
    <view class="modal-header">
      <text class="modal-title">超时计算详情</text>
      <text class="modal-close" bindtap="hideOvertimeDetail">×</text>
    </view>
    <view class="modal-body">
      <view class="detail-item">
        <text class="detail-title">租期时间计算：</text>
        <text class="detail-content">{{timeOvertimeDetail}}</text>
      </view>
      <view class="detail-item">
        <text class="detail-title">工作小时数计算：</text>
        <text class="detail-content">{{hoursOvertimeDetail}}</text>
      </view>
      <view class="detail-item">
        <text class="detail-title">最终超时原因：</text>
        <text class="detail-content">{{finalOvertimeReason}}</text>
      </view>
    </view>
  </view>
</view>