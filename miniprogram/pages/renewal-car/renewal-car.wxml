<view class="renew-container">
  <!-- è®¢å•ä¿¡æ¯ -->
  <view class="order-info">
    <view class="info-header">
      <text class="info-title">è®¢å•ä¿¡æ¯</text>
    </view>
    <view class="info-row">
      <text class="info-label">é—¨åº—åç§°ï¼š</text>
      <text class="info-value">{{orderInfo.storeName}}</text>
    </view>
    <view class="info-row">
      <text class="info-label">ç®¡ç†å‘˜ï¼š</text>
      <text class="info-value">{{orderInfo.managerName}}</text>
      <text class="phone-link" bindtap="makePhoneCall" data-phone="{{orderInfo.managerPhone}}">{{orderInfo.managerPhone}}</text>
    </view>
    <view class="info-row">
      <text class="info-label">è½¦å‹åç§°ï¼š</text>
      <text class="info-value">{{orderInfo.carModel}}</text>
    </view>
    <view class="info-row">
      <text class="info-label">åŸç§ŸæœŸï¼š</text>
      <text class="info-value">{{orderInfo.originalStartTime}} â€”â€” {{orderInfo.originalEndTime}}</text>
    </view>
    <view class="info-row">
      <text class="info-label">åŸç§Ÿå¤©æ•°ï¼š</text>
      <text class="info-value highlight">{{orderInfo.originalDays}}å¤©</text>
    </view>
  </view>

  <!-- ä¼šå‘˜è´­ä¹°å¡ç‰‡ -->
  <view class="member-card" wx:if="{{showMemberCard}}">
    <view class="info-header">
      <text class="info-title">ä¼šå‘˜ç‰¹æƒ</text>
    </view>
    <view class="member-content">
      <view class="member-benefits">
        <view class="benefit-item">
          <text class="benefit-icon">ğŸ‰</text>
          <text class="benefit-text">ç»­ç§Ÿäº«å—{{membershipInfo.discountText}}ä¼˜æƒ </text>
        </view>
        <view class="benefit-item">
          <text class="benefit-icon">âš¡</text>
          <text class="benefit-text">ä¸“å±å®¢æœä¼˜å…ˆæœåŠ¡</text>
        </view>
        <view class="benefit-item">
          <text class="benefit-icon">ğŸ”§</text>
          <text class="benefit-text">å…è´¹è®¾å¤‡æ£€æµ‹æœåŠ¡</text>
        </view>
      </view>
      <view class="member-purchase">
        <view class="purchase-option">
          <checkbox-group bindchange="onPurchaseMembershipChange">
            <label class="checkbox-label">
              <checkbox value="true" checked="{{purchaseMembership}}" color="#ff7200"/>
              <text class="purchase-text">è´­ä¹°ä¼šå‘˜</text>
              <text class="member-price">Â¥{{membershipInfo.price}}</text>
            </label>
          </checkbox-group>
        </view>
        <view class="member-tip">
          <text class="tip-text">æœ¬æ¬¡ç»­ç§Ÿç«‹å³äº«å—ä¼šå‘˜ä»·æ ¼</text>
        </view>
      </view>
    </view>
  </view>

  <!-- ç»­ç§Ÿè®¾ç½® -->
  <view class="renew-section">
    <view class="info-header">
      <text class="info-title">ç»­ç§Ÿè®¾ç½®</text>
    </view>
    <view class="renew-input-row">
      <text class="input-label">ç»­ç§Ÿå¤©æ•°ï¼š</text>
      <input 
        class="day-input" 
        type="number" 
        placeholder="è¯·è¾“å…¥ç»­ç§Ÿå¤©æ•°"
        value="{{renewDays}}"
        bindinput="onRenewDaysChange"
        bindblur="onRenewDaysBlur"
        min="1"
      />
      <text class="input-unit">å¤©</text>
    </view>
    <view class="input-tip">*æœ€å°‘ç»­ç§Ÿ1å¤©</view>
    <view class="error-tip" wx:if="{{daysErrorTip}}">
      <text class="error-text">{{daysErrorTip}}</text>
    </view>
    
    <!-- æ–°ç§ŸæœŸæ˜¾ç¤º -->
    <view class="new-period" wx:if="{{showNewPeriod}}">
      <view class="period-header">
        <text class="period-title">æ–°ç§ŸæœŸ</text>
      </view>
      <view class="period-display">
        <text class="period-text">{{newStartTime}} â€”â€” {{newEndTime}}</text>
        <text class="period-days">(å…±{{totalDays}}å¤©)</text>
      </view>
    </view>
  </view>

  <!-- æ”¯ä»˜æ˜ç»† -->
  <view class="payment-detail" wx:if="{{showPaymentDetail}}">
    <view class="info-header">
      <text class="info-title">æ”¯ä»˜æ˜ç»†</text>
    </view>
    <view class="detail-row">
      <text class="detail-label">ç»­ç§Ÿå¤©æ•°ï¼š</text>
      <text class="detail-value">{{renewDays}}å¤©</text>
    </view>
    <view class="detail-row">
      <text class="detail-label">ç»­ç§Ÿå•ä»·ï¼š</text>
      <text class="detail-value">
        Â¥{{currentRenewPrice}}/å¤©
        <text class="original-price" wx:if="{{(isMember || purchaseMembership) && currentRenewPrice != renewPrice}}">
          åŸä»·Â¥{{renewPrice}}
        </text>
      </text>
    </view>
    <view class="detail-row">
      <text class="detail-label">ç»­ç§Ÿå°è®¡ï¼š</text>
      <text class="detail-value">Â¥{{renewSubtotal}}</text>
    </view>
    
    <!-- ä¼šå‘˜è´¹ç”¨ -->
    <view class="detail-row" wx:if="{{purchaseMembership && membershipFee > 0}}">
      <text class="detail-label">ä¼šå‘˜è´¹ç”¨ï¼š</text>
      <text class="detail-value member-fee">Â¥{{membershipFee}}</text>
    </view>
    
    <view class="detail-row subtotal-row">
      <text class="detail-label">æœåŠ¡è´¹å‰å°è®¡ï¼š</text>
      <text class="detail-value">Â¥{{serviceSubtotal}}</text>
    </view>
    
    <!-- ç³»ç»ŸæœåŠ¡è´¹ -->
    <view class="detail-row">
      <text class="detail-label">ç³»ç»ŸæœåŠ¡è´¹({{serviceRateDisplay}}%)ï¼š</text>
      <text class="detail-value service-fee">Â¥{{serviceFee}}</text>
    </view>
    
    <view class="detail-row total-row">
      <text class="detail-label">æ€»è®¡ï¼š</text>
      <text class="detail-value total-price">Â¥{{totalAmount}}</text>
    </view>
  </view>

  <!-- åº•éƒ¨æ”¯ä»˜åŒºåŸŸ -->
  <view class="payment-section">
    <view class="payment-left">
      <text class="payment-label">éœ€è¦æ”¯ä»˜ï¼š</text>
      <text class="payment-amount">Â¥{{totalAmount || '0.00'}}</text>
    </view>
    <button class="payment-btn" bindtap="submitPayment" disabled="{{!canPay}}">
      {{paymentButtonText}}
    </button>
  </view>
</view>

<!-- æ”¯ä»˜ç¡®è®¤å¼¹çª— -->
<view class="modal-mask" wx:if="{{showPaymentModal}}" bindtap="hidePaymentModal">
  <view class="modal-content" catchtap="stopPropagation">
    <view class="modal-header">
      <text class="modal-title">ç¡®è®¤æ”¯ä»˜</text>
      <text class="modal-close" bindtap="hidePaymentModal">Ã—</text>
    </view>
    <view class="modal-body">
      <view class="confirm-detail">
        <view class="confirm-row">
          <text class="confirm-label">ç»­ç§Ÿå¤©æ•°ï¼š</text>
          <text class="confirm-value">{{renewDays}}å¤©</text>
        </view>
        <view class="confirm-row">
          <text class="confirm-label">ç»­ç§Ÿå•ä»·ï¼š</text>
          <text class="confirm-value">Â¥{{currentRenewPrice}}/å¤©</text>
        </view>
        <view class="confirm-row">
          <text class="confirm-label">ç»­ç§Ÿå°è®¡ï¼š</text>
          <text class="confirm-value">Â¥{{renewSubtotal}}</text>
        </view>
        <view class="confirm-row" wx:if="{{purchaseMembership && membershipFee > 0}}">
          <text class="confirm-label">ä¼šå‘˜è´¹ç”¨ï¼š</text>
          <text class="confirm-value">Â¥{{membershipFee}}</text>
        </view>
        <view class="confirm-row">
          <text class="confirm-label">ç³»ç»ŸæœåŠ¡è´¹ï¼š</text>
          <text class="confirm-value">Â¥{{serviceFee}}</text>
        </view>
        <view class="confirm-row">
          <text class="confirm-label">æ–°ç§ŸæœŸï¼š</text>
          <text class="confirm-value">{{newStartTime}} â€”â€” {{newEndTime}}</text>
        </view>
        <view class="confirm-row total-confirm">
          <text class="confirm-label">æ”¯ä»˜é‡‘é¢ï¼š</text>
          <text class="confirm-value highlight">Â¥{{totalAmount}}</text>
        </view>
      </view>
      <view class="modal-buttons">
        <button class="cancel-btn" bindtap="hidePaymentModal">å–æ¶ˆ</button>
        <button class="confirm-btn" bindtap="confirmPayment">ç¡®è®¤æ”¯ä»˜</button>
      </view>
    </view>
  </view>
</view>