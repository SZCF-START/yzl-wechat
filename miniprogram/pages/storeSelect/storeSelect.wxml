<navigation-bar title="é€‰æ‹©é—¨åº—" background-color="{{nbBackgroundColor}}" back="{{true}}" customBack="{{true}}" bind:back="onBack" />

<view class="container">
  <!-- å›ºå®šé¡¶éƒ¨æœç´¢åŒºåŸŸ -->
  <view class="header1">
    <view class="header">
      <view class="search-wrapper">
        <!-- åŸå¸‚é€‰æ‹© + æœç´¢æ¡†éƒ¨åˆ† -->
        <view class="search-box">
          <view class="city-select" bindtap="onCityTap">
            <text class="city-text">{{ currentCity }} â–¾</text>
          </view>
          <view class="divider"></view>
          <!-- æœç´¢æ¡† -->
          <view class="search-bar" bindtap="onSearchTap">
            <image class="search-icon" src="/assets/search.png" />
            <text class="search-placeholder">è¾“å…¥æ™¯ç‚¹ã€åœ°å€å¯»æ‰¾é™„è¿‘é—¨åº—</text>
          </view>
        </view>

        <!-- åœ°å›¾æŒ‰é’® -->
        <view class="map-btn" bindtap="onMapTap">åœ°å›¾</view>
      </view>
    </view>

    <!-- åœ°å›¾ -->
    <view class="map-container">
      <map
        id="storeMap"
        latitude="{{latitude}}"
        longitude="{{longitude}}"
        scale="14"
        show-location
        markers="{{markers}}"
        style="width: 100%; height: 100%;">
      </map>

      <!-- è¦†ç›–åœ¨åœ°å›¾ä¸Šçš„æŒ‰é’® - æ·»åŠ æ¡ä»¶æ˜¾ç¤º -->
      <cover-view class="map-overlay" wx:if="{{!showSearchMask}}">
        <cover-view class="view-map-btn" bindtap="onViewBigMap">çœ‹å¤§åœ°å›¾</cover-view>
      </cover-view>
    </view>
  </view>

  <!-- é—¨åº—åˆ—è¡¨ -->
  <view class="store-section">
    <!-- å·¦ä¾§åŒºåŸŸåˆ—è¡¨ -->
    <scroll-view scroll-y class="area-list" scroll-with-animation="{{false}}">
      <view class="area1">
        <block wx:for="{{areaList}}" wx:key="name">
          <view
            class="area-item {{selectedAreaIndex === index ? 'active' : ''}}"
            data-index="{{index}}"
            bindtap="onAreaTap"
          >{{item.name}}</view>
        </block>
      </view>
    </scroll-view>

    <!-- å³ä¾§é—¨åº—åˆ—è¡¨ -->
    <scroll-view 
      id="storeScrollView"
      scroll-y 
      class="store-list" 
      bindscroll="onStoreScroll" 
      scroll-with-animation
      scroll-top="{{scrollTop}}"
      enhanced="{{true}}"
      bounces="{{false}}"
      show-scrollbar="{{false}}"
    >
      <view class="store-list-content">
        <block wx:for="{{areaList}}" wx:key="name" wx:for-item="area" wx:for-index="areaIndex">
          <view class="area-section" id="area-{{areaIndex}}">
            <view class="area-title">
              {{area.name}}
            </view>
            <block wx:for="{{area.stores}}" wx:key="name" wx:for-item="store">
              <view class="store-card {{selectedStore === store.name && area.name === 'å¸¸ç”¨é—¨åº—' ? 'selected' : ''}} {{area.name === 'å¸¸ç”¨é—¨åº—' ? 'favorite-store' : 'other-store'}}" 
                    data-store="{{store}}" 
                    data-area="{{area.name}}"
                    bindtap="onCardTap">
                <view class="store-header">
                  <view class="store-name-wrapper">
                    <text class="store-name">{{store.name}}</text>
                    <text class="store-arrow">></text>
                  </view>
                  <view class="tag-list">
                    <block wx:for="{{store.tags}}" wx:key="label" wx:for-item="tag">
                      <text class="tag {{'tag-' + tag.type}}">{{tag.label}}</text>
                    </block>
                  </view>
                </view>

                <view class="store-addr">åœ°å€ï¼š{{store.address}}</view>
                <view class="store-time">è¥ä¸šæ—¶é—´ï¼š{{store.openTime}} - {{store.closeTime}}</view>

                <view class="store-actions">
                  <button class="action-btn" open-type="makePhoneCall" data-phone="{{store.phone}}" catchtap="onPhoneTap">
                    <text class="icon">ğŸ“</text> ç”µè¯
                  </button>
                  <button class="action-btn" catchtap="onGuideTap" data-lat="{{store.latitude}}" data-lng="{{store.longitude}}" data-name="{{store.name}}" data-address="{{store.address}}">
                    <text class="icon">ğŸ“</text> é—¨åº—æŒ‡å¼•
                  </button>
                </view>
              </view>

              <!-- åˆ†éš”çº¿ -->
              <view class="card-divider"></view>
            </block>
          </view>
        </block>
      </view>
    </scroll-view>
  </view>

  <!-- æœç´¢è’™å±‚ - ç§»åˆ°æœ€åç¡®ä¿æœ€é«˜å±‚çº§ -->
  <view wx:if="{{showSearchMask}}" class="mask-layer">
    <navigation-bar title="é€‰æ‹©é—¨åº—" background-color="{{nbBackgroundColor}}" back="{{true}}" bind:back="onCancelSearch" />
    <view class="search-header">
      <input class="search-input" placeholder="è¯·è¾“å…¥é—¨åº—åã€åœ°å€" auto-focus />
      <text class="cancel-btn" bindtap="onCancelSearch">å–æ¶ˆ</text>
    </view>
    <!-- æœç´¢ç»“æœåŒºåŸŸ -->
    <view class="search-results">
      <!-- è¿™é‡Œå¯ä»¥æ·»åŠ æœç´¢ç»“æœå†…å®¹ -->
    </view>
  </view>
</view>