import getParameterByName from"../utils/getParameterByName";import Log from"../constants/log";Page({data:{token:"",appName:"",isAgree:!!wx.getStorageSync("isAgree"),showAuth:!1,showWebView:!1,redirectUri:"",isNavigating:!1},onLoad(e){e=e.token;this.setData({token:e,isAgree:!!wx.getStorageSync("isAgree"),redirectUri:wx.eidBaseUrl+"/api/v1/Redirect?token="+e},()=>{this.setData({showWebView:!0}),this.navigateToEid()})},handleWebViewLoad(e){console.log("webview load",e.detail.src);var a=this.data["token"],e=getParameterByName("success",e.detail.src);e&&this.setData({showWebView:!1,showAuth:!0}),wx.reportLogToEid({token:a,event:Log.webViewResult,errMsg:"success参数为"+e})},handleWebViewError(e){console.log("webview error",e);var a=(this.setData({showWebView:!1,showAuth:!0}),this.data)["token"];wx.reportLogToEid({token:a,event:Log.webViewError,errMsg:e.detail.src})},navigateToEid(){console.log("navigateToEid",wx.eidEnvVersion);const a=this.data["token"],t=(this.setData({isNavigating:!0}),this);wx.navigateToMiniProgram({appId:"wx0e2cb0b052a91c92",path:"pages/huiyan/index",envVersion:wx.eidEnvVersion,extraData:{useHuiyan:!0,huiyanToken:a},success(){wx.eidTokenToCallback=a},fail(e){console.log("err",e),wx.eidTokenToCallback="",wx.navigateBack({success(){console.log("navigateToEid navigateToMiniProgram fail",e)}})},complete(e){t.setData({isNavigating:!1}),wx.reportLogToEid({token:a,event:Log.navigateToEid,errMsg:e.errMsg})}})}});